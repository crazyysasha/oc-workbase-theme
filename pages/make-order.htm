url = "/:category/:service?*"
layout = "make-order"
title = "make-order"
==
<?php
function onStart() {

    if (!$category =  $this->getCurrentCategory()) {
        return $this->controller->run('404');
    }
    
    $services = $this->getCurrentServices();

    $this['category'] = $category;

    $this['services'] = $services;
    
    
}


function onGetSlideView()
{
    $category = $this->getCurrentCategory();

    $services = $this->getCurrentServices();
    
    if (! $category) {
        \Flash::error('Категория не найдена!');
    }
    
    if ($services->isNotEmpty()) {
        return ['#slideContainer' => $this->renderPartial('make-order/select-child-service'), ];
    }

    return ["#slideContainer" => $this->renderPartial('make-order/search-service'), ];
}

function onRenderSearchServiceView()
{
    $category = $this->getCurrentCategory();
    
    if (! $category) {
        \Flash::error('Категория не найдена!');
    }
    
    return [
        'url' => $this->controller->pageUrl('make-order', ['category' => $category->slug, 'service' => '']),
        "#slideContainer" => $this->renderPartial('make-order/search-service'),
    ];
}

function getCurrentServices($slug = null)
{
    return $this['services'] = 
        Crazy\FreeLancer\Models\Service
            ::whereIn('slug', explode('/', $slug ?? $this->param('service')))
            ->getNested();
}

function getCurrentCategory()
{
    return $this['category'] = Crazy\FreeLancer\Models\Category::where('slug', $this->param('category'))
        ->first();
}

function onSearchService()
{
    
    $category = $this->param('category');
    $services = explode('/', $this->param('service'));

    $services = array_filter($services, function ($item) {
        return strlen($item);
    });

    $service = \Crazy\FreeLancer\Models\Service::where('id', post('service'))
        ->orSearchWhere(post('search'), ['name', 'slug'])->first();
    
    if (!$service) {
        throw new \ValidationException(['search' => ['Услуга не найдена']]);
    }
    $servSlug = implode('/', [ ...$services, $service->slug,]);
    
    $url = $this->controller->pageUrl('make-order', [
        'category' => $category, 
        'service' => $servSlug
    ]);

    if ($service->children->isNotEmpty()) {
        $nextPartial = 'make-order/select-child-service.htm';
    } else {
        $nextPartial = 'make-order/select-place.htm';
    }
    $this->getCurrentServices($servSlug);
    return [
        'url' => $url,
        '#slideContainer' => $this->renderPartial($nextPartial),
    ];
}

function onSelectService()
{
    $category = $this->param('category');
    $services = explode('/', $this->param('service'));

    $services = array_filter($services, function ($item) {
        return strlen($item);
    });

    $service = \Crazy\FreeLancer\Models\Service::where('id', post('service'))->first();

    if (!$service) {
        return [
            '#slideContainer' => $this->renderPartial('make-order/select-place')
        ];
    }
    
    $servSlug = implode('/', [ ...$services, $service->slug,]);
    
    $url = $this->controller->pageUrl('make-order', [
        'category' => $category, 
        'service' => $servSlug
    ]);

    if ($service->children->isNotEmpty()) {
        $nextPartial = 'make-order/select-child-service.htm';
    } else {
        $nextPartial = 'make-order/select-place.htm';
    }
    $this->getCurrentServices($servSlug);
    return [
        'url' => $url,
        '#slideContainer' => $this->renderPartial($nextPartial),
    ];
   
}

function onSelectPlace()
{
    return [
        '#slideContainer' => $this->renderPartial('make-order/set-description')
    ];
}

function onSetDescription()
{
    return [
        '#slideContainer' => $this->renderPartial('make-order/set-price')
    ];
}

function onSetPrice()
{
    \Flash::success('Ваша заявка успешно принята');
}
?>
==
{##}
<section x-data="{IsActive: 1,}" class="relative px-1 sm:px-2 md:px-4 lg:px-0" >
    {# 
        {% partial "swiper/specs" %}
    #}
  
    <div class="grid grid-cols-1 lg:grid-cols-3 container gap-4 mt-2" x-data="{activeTab: 'order'}">

        <div class="lg:col-span-2 order-2 lg:order-1 h-full bg-white rounded-md">
            <div class="p-4 h-full" id="slideContainer" x-init="$.request('onGetSlideView')">
            </div>
        </div>

        <div class="lg:col-span-1 order-1 lg:order-2 bg-white rounded-md">
            <ul class="p-4 flex flex-row lg:flex-col justify-around">
                <li class="p-2 text-xs sm:text-sm md:text-md lg:text-base bg-gray-300 bg-opacity-0 hover:bg-opacity-50 my-1 rounded-md font-semibold" :class="{'hover:bg-opacity-100 bg-opacity-75': true}">
                    Заказ
                </li>
                
                <li class="p-2 text-xs sm:text-sm md:text-md lg:text-base bg-gray-300 bg-opacity-0 hover:bg-opacity-50 my-1 rounded-md font-semibold" :class="{'hover:bg-opacity-100 bg-opacity-75': false}">
                    Поддержка
                </li>
                
                <li class="p-2 text-xs sm:text-sm md:text-md lg:text-base bg-gray-300 bg-opacity-0 hover:bg-opacity-50 my-1 rounded-md font-semibold" :class="{'hover:bg-opacity-100 bg-opacity-75': false}">
                    Специалисты
                </li>
            </ul>
            <div class="hidden lg:block rounded-md w-full mt-5">
                <div class=" rounded-md">
                    <div class="w-full my-5">
                            <div class="relative">
                    
                                <div class="swiper mySwiper w-full">
                                    <div class="swiper-wrapper w-full">
                                      <div class="swiper-slide mx-0 w-full rounded-md "><img class="r p-0ounded-md" src="{{'assets/images/el-banner1.jpg' | theme}}" width="100%" alt=""></div>
                                      <div class="swiper-slide w-full rounded-md"><img class="rounded-md" src="{{'assets/images/el-banner6.jpg' | theme}}" width="100%" alt=""></div>
                                    </div>
                                </div>                                                 
                            </div>
                    </div>
                    

                    <div class="w-full my-5">
                        <div class="relative">
                
                            <div class="swiper mySwiper w-full">
                                <div class="swiper-wrapper w-full">
                                  <div class="swiper-slide w-full rounded-md"><img class="rounded-md" src="{{'assets/images/el-banner4.jpg' | theme}}" width="100%" alt=""></div>
                                  <div class="swiper-slide w-full rounded-md"><img class="rounded-md" src="{{'assets/images/el-banner5.jpg' | theme}}" width="100%" alt=""></div>
                                </div>
                            </div>                                                 
                        </div>
                    </div>

                    <div class="w-full my-5">
                        <div class="relative">
                
                            <div class="swiper mySwiper w-full">
                                <div class="swiper-wrapper w-full">
                                <div class="swiper-slide w-full rounded-md"><img class="rounded-md" src="{{'assets/images/el-banner3.jpg' | theme}}" width="100%" alt=""></div>
                                <div class="swiper-slide w-full rounded-md"><img class="rounded-md" src="{{'assets/images/el-banner2.jpg' | theme}}" width="100%" alt=""></div>
                                </div>
                            </div>                                                 
                        </div>
                    </div>

            
                </div>
            </div>
        </div>

    </div>

    <div class="lg:grid grid-cols-3 container relative">
        
        <div class="lg:col-span-2 col-start-1 col-end-2 m-2 mb-0 relative">
            <!--
            <div class=" lg:hidden bg-white rounded-md px-4 mb-4 py-1 sticky z-20" 
                x-bind:style="{top: `${document.querySelector('header').offsetHeight}px`}"
                x-data="{ showBar: false }" 
                :class="{ 'border-b border-gray-300 shadow-2xl transition duration-100' : showBar }"
                @scroll.window="showBar = (window.pageYOffset > 20) ? true : false">
                <ul class="flex justify-between text-center">
                    <li class="" @click="IsActive = 1">
                        <div class="flex items-center justify-center" >
                            <span  class="text-xl text-gray-500">
                                <i :class="{ 'text-black': IsActive === 1 }" class="fa fa-pie-chart" aria-hidden="true">
                                </i>
                            </span>
                        </div>
                        <div>
                            <span class="text-xs sm:text-sm md:text-md ">Заказ</span>
                        </div>
                    </li>
                    
                    <li class="" @click="IsActive = 3">
                        <div class="flex items-center justify-center">
                            <span  class="text-xl text-gray-500 before:content-['123']  before:absolute">
                                <i :class="{ 'text-black': IsActive === 3 }" class="fa fa-users" aria-hidden="true"></i>
                            </span>
                        </div>
                        <div>
                            <span class="text-xs sm:text-sm md:text-md ">Специалисты</span>
                        </div>
                    </li>

                    <li class="" @click="IsActive = 4">
                        <div class="flex items-center justify-center">
                            <span  class="text-xl mr-1 text-gray-500"><i :class="{ 'text-black': IsActive === 4 }" class="fa fa-comments" aria-hidden="true"></i></span>
                        </div>
                        <div>
                            <span class="text-xs sm:text-sm md:text-md ">Отклики</span>
                        </div>
                    </li>

                </ul>
            </div>
            -->

            <div 
                class="hidden pt-4 rounded-md w-full" 
                id="MakeOrderRadio">

                <div 
                    x-cloak 
                    x-show="IsActive === 1" 
                    class="px-4 relative">
                </div>

                <div x-cloak x-show="IsActive === 2">
                    help
                </div>

                <div x-cloak x-show="IsActive === 3" class="px-4 py-2">

                    <div>
                        <div class="md:flex">
                            <div class="flex items-center mt-2 mr-8">
                                <span class="bg-blue-100 rounded-full h-10 w-10 flex items-center justify-center mr-4">
                                    <i class="icon-settings text-sm md:text-lg "></i>
                                </span>
                                <span class="text-sm md:text-lg font-medium text-blue-700"> Электрика </span>
                            </div>
                            <div class="flex items-center mt-2">
                                <span class="bg-blue-100 rounded-full h-10 w-10 flex items-center justify-center mr-4">
                                    <i class="icon-location text-sm md:text-lg "></i>
                                </span>
                                <span class="text-sm md:text-lg font-medium text-blue-700">г. Ташкент, улица Афросиаб, 41</span>
                            </div>
                        </div>
                        <div class="mt-4">
                            <span class="text-sm md:text-lg text-gray-300 mr-4">Сортировка:</span>
                            <select class="p-2 px-4 border border-gray-300 rounded-md focus:outline-none focus:border-gray-500 text-sm md:text-md" name="sorting" id="sorting">
                                <option value="Подходящие">Подходящие</option>
                                <option value="По отзывам">По отзывам</option>
                                <option value="Пр возрастанию цены">
                                  Пр возрастанию цены
                                </option>
                                <option value="По убыванию цены">По убыванию цены</option>
                                <option value="По местонахождению">
                                  По местонахождению
                                </option>
                            </select>
                        </div>
                        <hr class="border-gray-500 border-dashed my-4 md:my-8">
                    </div>

                    <div class="md:grid md:grid-cols-3">


                        <div class="col-span-2">

                            <!-- Специалисты  -->
                            <div >

                                <div class="flex items-center">

                                    <div class="mr-8">
                                        <img src="{{'assets/images/userlistchatbig.png' | theme}}" alt="">
                                    </div>
    
                                    <div class="">
                                        <h5 class="font-bold text-sm  md:text-md lg:text-lg">Акмаль Халиков </h5>
                                        <span class="text-xs md:text-sm lg:text-md text-gray-300">Был в сети сегодня в 12:20</span>
                                        <div class="flex justify-start text text-sm md:text-md text-gray-300 font-semibold my-1">
                                            <div>
                                                <i class="icon-orangestar mr-2"></i>
                                                <span>10 из 10</span>
                                            </div>
                                            <div>
                                                <i class="icon-comments mx-2"></i>
                                                <span> 20 </span>
                                            </div>
                                            <div>
                                                <i class="icon-like mx-2"></i>
                                                <span> Очень хвалят </span>
                                            </div>
                                        </div>
                                        <div class="my-1">
                                            <span class="font-medium text-sm md:text-md">
                                                Выезд по
                                                <a class="text-blue-500" href="#">Ташкенту, Ташкентской обл.</a>
                                            </span>
                                        </div>
                                    </div>
    
                                </div>

                                <div class="mt-4">

                                    <div class="">
                                        <h4 class="text-md lg:text-lg font-semibold text-orange-500">
                                            Квалификация подтверждена
                                        </h4>
                                        <p class="text-sm md:text-md ">
                                             Специалист сдал экзамен по услугам: электрика, монтраж слаботочных сетей.
                                        </p>
                                    </div>
                                    <div class="flex justify-between my-4">
                                        <img src="{{'assets/images/groupImg.png' | theme}}" alt="">
                                        <img src="{{'assets/images/groupImg2.png' | theme}}" alt="">
                                        <img src="{{'assets/images/groupImg3.png' | theme}}" alt="">
                                        <img src="{{'assets/images/groupImg4.png' | theme}}" alt="">
                                    </div>
                                    <div class="my-4">
                                        <h5 class="text-md md:text-lg font-medium">О себе:</h5>
                                        <p class="text-sm lg-text-md">
                                            Техник-электрик,Большой опыт в решении ваших 
                                            электромонтажных задач. Выбрав меня вы облегчите 
                                            себе текущий или наступаюшую стадию электрофикации. 
                                            Обещаю,результатом останетесь довольны! Работу сделаю 
                                            быстро и качественно.
                                        </p>
                                        <div class="flex justify-between py-4 border-b border-gray-500 border-dotted">
                                            <a class="text-sm md:text-md text-blue-500" href="#">
                                                Подробнее
                                            </a>
                                            <a href="#">
                                                <img class="w-5 h-5" src="{{'assets/images/googletranslate.png' | theme}}" alt="">
                                            </a>
                                        </div>
                                    </div>

                                    <div class="my-4">
                                        <h5 class="text-md md:text-lg font-medium">Образование и опыт:  </h5>
                                        <p class="text-sm lg-text-md">
                                            Ташкентский государственный технический 
                                            унивеситет, работал в компании "Электромонтаж Сервис" 
                                            с 2010 по 2019год, на данный момент работаю со своей командой командой.
                                        </p>
                                        <div class="flex justify-between py-4 border-b border-gray-500 border-dotted">
                                            <a class="text-sm md:text-md text-blue-500" href="#">
                                                Подробнее
                                            </a>
                                            <a href="#">
                                                <img class="w-5 h-5" src="{{'assets/images/googletranslate.png' | theme}}" alt="">
                                            </a>
                                        </div>
                                    </div>

                                    <div class="my-4">
                                        <h5 class="text-md md:text-lg font-medium">Отзывы:</h5>
                                        <p class="text-sm lg-text-md">
                                            Нам нужен был электрик. Мастер произвел замечательное 
                                            впечатление. Работу выполнил хорошо, установил розетки.
                                             Мастер сказал, что если понадобятся еще услуги электрика, 
                                             то всегда можно к нему обратиться.
                                        </p>
                                        <div class="flex justify-between py-4 border-b border-gray-500 border-dotted">
                                            <a class="text-sm md:text-md text-blue-500" href="#">
                                                Все отзывы (20)
                                            </a>
                                            <a href="#">
                                                <img class="w-5 h-5" src="{{'assets/images/googletranslate.png' | theme}}" alt="">
                                            </a>
                                        </div>
                                    </div>

                                    <div class="mt-4">
                                        <h5 class="text-md md:text-lg font-medium">Услуги и цены</h5>
                                        <div class="text-sm lg-text-md">
                                            <ul>
                                                <li class="flex justify-between my-1 border-b border-gray-500 border-dotted">
                                                    <span class="-mb-1 bg-white">Монтаж проводки</span>
                                                    <span class="text-gray-300 font-medium -mb-1 bg-white">От 25 000 сум</span>
                                                </li>
                                                <li class="flex justify-between my-1 border-b border-gray-500 border-dotted">
                                                    <span class="-mb-1 bg-white">Установка розетки, 1 точка</span>
                                                    <span class="text-gray-300 font-medium -mb-1 bg-white">От 15 000 сум</span>
                                                </li>
                                                <li class="flex justify-between my-1 border-b border-gray-500 border-dotted">
                                                    <span class="-mb-1 bg-white">Установка выключателя</span>
                                                    <span class="text-gray-300 font-medium -mb-1 bg-white">От 10 000 сум</span>
                                                </li>
                                                <li class="flex justify-between my-1 border-b border-gray-500 border-dotted">
                                                    <span class="-mb-1 bg-white">Установка светильника</span>
                                                    <span class="text-gray-300 font-medium -mb-1 bg-white">От 25 000 сум</span>
                                                </li>
                                            </ul>
                                        </div>
                                        <div class="flex justify-between pt-4 ">
                                            <a class="text-sm md:text-md text-blue-500" href="#">
                                                Все услуги и цены (18)
                                            </a>
                                            <a href="#">
                                                <img class="w-5 h-5" src="{{'assets/images/googletranslate.png' | theme}}" alt="">
                                            </a>
                                        </div>
                                    </div>
                                    

                                </div>

                            </div>
                        </div>

                        <div class="col-span-1">
                            <div class="w-full px-3">
                                <a href="#" class="bg-blue-900 rounded-md block w-full py-3 text-center text-white text-sm md:text-md font-medium">
                                    Написать сообщение
                                </a>
                                <p class="my-2 text-xs md:text-sm lg:text-md text-center">Вы сможете написать после заполнения деталей заказа</p>
                            </div>
                        </div>

                    </div>

                    <hr class="w- border-gray-500 border-dashed my-4 md:my-8">

                </div>

                <div x-cloak x-show="IsActive === 4">
                    chat
                </div>

            </div>

        </div>

        {% put scripts %}
            <script>
                var swiper = new Swiper('.mySwiper', {
                    autoplay: {
                         delay: 5000,
                        },
                    effect: 'fade'
                    });
            </script>
        {% endput %}
    </div>
</section>